!function(t,n){"function"==typeof define&&define.amd?define(n):"object"==typeof exports?module.exports=n():t.Walkway=n()}(this,function(t){"use strict";function n(t){var n=["path","line","polyline"],e=n.reduce(function(n,e){return n+t+" "+e+", "},"");return e.slice(0,-2)}function e(t){return this instanceof e?("string"==typeof t&&(t={selector:t}),t.selector?(this.opts=t,this.selector=t.selector,this.duration=t.duration||500,this.scrollPosition=t.scrollPosition||-1,this.easing="function"==typeof t.easing?t.easing:l[t.easing]||l.easeInOutCubic,this.id=!1,this.elements=this.getElements(),this.callback=t.callback,this.setInitialStyles(),h=h.concat(this.elements),void f.push(this)):this.error("A selector needs to be specified")):new e(t)}function i(t,n,e,i){this.el=t,this.duration=n,this.scrollPosition=e?e:-1,this.easing=i,this.animationStart=null,this.animationStarted=!1}function o(t,n,e,o){i.call(this,t,n,e,o),this.length=t.getTotalLength()}function a(t,n,e,o){i.call(this,t,n,e,o),this.length=c(t)}function r(t,n,e,o){i.call(this,t,n,e,o),this.length=s(t)}function s(t){var n,e,i,o,a,r=0,s=t.points.numberOfItems;for(a=1;a<s;a++)n=t.points.getItem(a-1).x,e=t.points.getItem(a).x,i=t.points.getItem(a-1).y,o=t.points.getItem(a).y,r+=Math.sqrt(Math.pow(n-e,2)+Math.pow(i-o,2));return r}function c(t){var n=t.getAttribute("x1"),e=t.getAttribute("x2"),i=t.getAttribute("y1"),o=t.getAttribute("y2");return Math.sqrt(Math.pow(n-e,2)+Math.pow(i-o,2))}var u=0;window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,window.cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame,window.requestAnimationFrame||(window.requestAnimationFrame=function(t){var n=(new Date).getTime(),e=Math.max(0,16-(n-u)),i=window.setTimeout(function(){t(n+e)},e);return u=n+e,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)});var l={linear:function(t){return t},easeInQuad:function(t){return t*t},easeOutQuad:function(t){return t*(2-t)},easeInOutQuad:function(t){return t<.5?2*t*t:-1+(4-2*t)*t},easeInCubic:function(t){return t*t*t},easeOutCubic:function(t){return--t*t*t+1},easeInOutCubic:function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1},easeInQuart:function(t){return t*t*t*t},easeOutQuart:function(t){return 1- --t*t*t*t},easeInOutQuart:function(t){return t<.5?8*t*t*t*t:1-8*--t*t*t*t},easeInQuint:function(t){return t*t*t*t*t},easeOutQuint:function(t){return 1+--t*t*t*t*t},easeInOutQuint:function(t){return t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t}},h=[],f=[];return document.addEventListener("visibilitychange",function(){if(document.hidden){for(var t=0,n=f.length;t<n;t++)f[t].cancel();for(var e=0,i=h.length;e<i;e++)h[e].complete()}},!1),e.prototype={constructor:e,error:function(t){console.error("Walkway error: "+t)},getElements:function(){var t=this,e=n(this.selector),i=document.querySelectorAll(e);return i=Array.prototype.slice.call(i),i.map(function(n){return"path"===n.tagName?new o(n,t.duration,t.scrollPosition,t.easing):"line"===n.tagName?new a(n,t.duration,t.scrollPosition,t.easing):"polyline"===n.tagName?new r(n,t.duration,t.scrollPosition,t.easing):void 0})},setInitialStyles:function(){this.elements.forEach(function(t){t.el.style.strokeDasharray=t.length+" "+t.length,t.el.style.strokeDashoffset=t.length})},draw:function(t){var n=this.elements.length,e=this.elements.filter(function(t){return t.done}).length===n,i=null,o=!1;if(this.callback=t||this.callback,e)return this.callback&&"function"==typeof this.callback&&this.callback(),void this.cancel();for(;n--;)i=this.elements[n],o=i.update(),i.scrollPosition===-1&&o&&(i.done=!0);this.id=window.requestAnimationFrame(this.draw.bind(this,t))},cancel:function(){window.cancelAnimationFrame(this.id)},redraw:function(){this.cancel(),this.elements.forEach(function(t){t.reset()}),this.draw()}},i.prototype={constructor:i,update:function(){this.animationStarted||(this.animationStart=Date.now(),this.animationStarted=!0);var t=this.scrollPosition!==-1?window.scrollY/this.scrollPosition:this.easing((Date.now()-this.animationStart)/this.duration);return this.fill(t),t>=1},fill:function(t){var n=Math.ceil(this.length*(1-t));this.el.style.strokeDashoffset=n<0?0:Math.abs(n)},complete:function(){this.fill(1)},reset:function(){this.done=!1,this.animationStart=0,this.animationStarted=!1,this.fill(0)}},o.prototype=a.prototype=r.prototype=Object.create(i.prototype),e});